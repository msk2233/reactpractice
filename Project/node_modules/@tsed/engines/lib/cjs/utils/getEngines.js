"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getEngines = exports.getEngine = void 0;
const EnginesContainer_1 = require("../registries/EnginesContainer");
const callbackify = async (fn, cb) => {
    try {
        const html = await fn();
        cb && cb(null, html);
        return html;
    }
    catch (er) {
        if (cb) {
            cb(er);
        }
        else {
            throw er;
        }
    }
};
function getEngine(name) {
    const cb = async (path, options, cb) => {
        const engine = EnginesContainer_1.engines.get(name);
        await engine.$onInit();
        return callbackify(() => engine.renderFile(path, options), cb);
    };
    cb.render = async (template, options, cb) => {
        const engine = EnginesContainer_1.engines.get(name);
        await engine.$onInit();
        return callbackify(() => engine.render(template, options), cb);
    };
    return cb;
}
exports.getEngine = getEngine;
let localEngines;
function getEngines() {
    localEngines =
        localEngines ||
            EnginesContainer_1.engines.getSupportedEngines().reduce((acc, key) => {
                return {
                    ...acc,
                    [key]: getEngine(key)
                };
            }, {});
    return localEngines;
}
exports.getEngines = getEngines;
//# sourceMappingURL=getEngines.js.map