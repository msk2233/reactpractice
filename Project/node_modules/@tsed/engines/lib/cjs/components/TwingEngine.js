"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TwingEngine = void 0;
const tslib_1 = require("tslib");
const viewEngine_1 = require("../decorators/viewEngine");
const Engine_1 = require("./Engine");
const fs_1 = require("fs");
let TwingEngine = class TwingEngine extends Engine_1.Engine {
    instance;
    $compile(template, options) {
        const engine = this.engine;
        if (!this.instance) {
            let loader = new engine.TwingLoaderNull();
            if (options.settings && options.settings.views && (0, fs_1.existsSync)(options.settings.views)) {
                loader = new engine.TwingLoaderFilesystem(options.settings.views);
            }
            this.instance = new engine.TwingEnvironment(loader);
        }
        const $cmp = this.instance.createTemplate(template);
        return async (options) => {
            const compile = await $cmp;
            return compile.render(options);
        };
    }
};
TwingEngine = tslib_1.__decorate([
    (0, viewEngine_1.ViewEngine)("twing")
], TwingEngine);
exports.TwingEngine = TwingEngine;
//# sourceMappingURL=TwingEngine.js.map