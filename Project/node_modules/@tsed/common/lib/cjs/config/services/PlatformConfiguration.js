"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PlatformConfiguration = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@tsed/core");
const di_1 = require("@tsed/di");
const json_mapper_1 = require("@tsed/json-mapper");
const rootDir = process.cwd();
/**
 * `PlatformConfiguration` contains all information about your Server configuration.
 */
let PlatformConfiguration = class PlatformConfiguration extends di_1.DIConfiguration {
    constructor() {
        super({ rootDir });
    }
    get port() {
        return this.httpPort;
    }
    set port(value) {
        this.httpPort = value;
    }
    get httpsOptions() {
        return this.getRaw("httpsOptions");
    }
    set httpsOptions(value) {
        this.setRaw("httpsOptions", value);
    }
    get httpPort() {
        return this.getRaw("httpPort");
    }
    set httpPort(value) {
        this.setRaw("httpPort", value);
    }
    get httpsPort() {
        return this.getRaw("httpsPort");
    }
    set httpsPort(value) {
        this.setRaw("httpsPort", value);
    }
    get mount() {
        return this.get("mount");
    }
    set mount(value) {
        this.setRaw("mount", value);
    }
    get statics() {
        return this.getRaw("statics") || this.getRaw("serveStatic") || {};
    }
    set statics(value) {
        this.setRaw("statics", value);
    }
    get acceptMimes() {
        return this.getRaw("acceptMimes");
    }
    set acceptMimes(value) {
        this.setRaw("acceptMimes", value || []);
    }
    get jsonMapper() {
        return {
            ...json_mapper_1.JsonMapperSettings
        };
    }
    set jsonMapper(options) {
        json_mapper_1.JsonMapperSettings.strictGroups = Boolean(options.strictGroups);
        json_mapper_1.JsonMapperSettings.disableUnsecureConstructor = Boolean(options.disableUnsecureConstructor);
        json_mapper_1.JsonMapperSettings.additionalProperties = Boolean((0, core_1.isBoolean)(options.additionalProperties) ? options.additionalProperties : options.additionalProperties === "accept");
    }
    get additionalProperties() {
        return this.get("converter.additionalProperties") === "accept";
    }
    /**
     *
     * @returns {string|number}
     */
    getHttpPort() {
        return (0, core_1.getHostInfoFromPort)("http", this.getRaw("httpPort"));
    }
    /**
     *
     * @param settings
     */
    setHttpPort(settings) {
        this.setRaw("httpPort", `${settings.address}:${settings.port}`);
    }
    /**
     *
     * @returns {string|number}
     */
    getHttpsPort() {
        return (0, core_1.getHostInfoFromPort)("https", this.getRaw("httpsPort"));
    }
    /**
     *
     * @param settings
     */
    setHttpsPort(settings) {
        this.setRaw("httpsPort", `${settings.address}:${settings.port}`);
    }
    getBestHost() {
        const { httpsPort, httpPort } = this;
        if (httpsPort) {
            return this.getHttpsPort();
        }
        if (httpPort) {
            return this.getHttpPort();
        }
        return {
            toString() {
                return "/";
            }
        };
    }
};
PlatformConfiguration = tslib_1.__decorate([
    (0, di_1.Injectable)({
        scope: di_1.ProviderScope.SINGLETON,
        global: true
    }),
    tslib_1.__metadata("design:paramtypes", [])
], PlatformConfiguration);
exports.PlatformConfiguration = PlatformConfiguration;
//# sourceMappingURL=PlatformConfiguration.js.map