"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ParamValidationError = void 0;
const core_1 = require("@tsed/core");
const exceptions_1 = require("@tsed/exceptions");
const ValidationError_1 = require("./ValidationError");
class ParamValidationError extends exceptions_1.BadRequest {
    name = "PARAM_VALIDATION_ERROR";
    dataPath;
    requestType;
    static from(metadata, origin = {}) {
        if (origin instanceof ValidationError_1.ValidationError || origin instanceof exceptions_1.BadRequest) {
            const name = (0, core_1.nameOf)(metadata.paramType)
                .toLowerCase()
                .replace(/parse|params|filter/gi, "");
            const expression = metadata.expression;
            const dataPath = `${name}${expression ? "." + expression : ""}`;
            const message = `Bad request on parameter "request.${dataPath}".\n${origin.message}`.trim();
            const error = new ParamValidationError(message);
            error.dataPath = String(metadata.expression) || "";
            error.requestType = (0, core_1.nameOf)(metadata.paramType);
            error.origin = origin.origin || origin;
            if (error.origin?.errors) {
                error.origin?.errors.forEach((error) => {
                    error.requestPath = name;
                    error.dataPath = error.dataPath || (expression ? `.${expression}` : "");
                });
            }
            return error;
        }
        return origin;
    }
}
exports.ParamValidationError = ParamValidationError;
//# sourceMappingURL=ParamValidationError.js.map